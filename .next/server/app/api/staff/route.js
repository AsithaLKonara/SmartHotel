"use strict";(()=>{var e={};e.id=6281,e.ids=[6281],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},15173:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>I,patchFetch:()=>U,requestAsyncStorage:()=>S,routeModule:()=>m,serverHooks:()=>N,staticGenerationAsyncStorage:()=>O,staticGenerationBailout:()=>R});var a={};r.r(a),r.d(a,{GET:()=>_,POST:()=>c});var s=r(95419),i=r(69108),n=r(99678),o=r(78070),E=r(81355),l=r(3205),u=r(44843),T=r(25252),d=r(52178),A=r(89391);let p=T.Ry({employeeId:T.Z_().min(1,"Employee ID is required"),name:T.Z_().min(1,"Name is required"),email:T.Z_().email("Invalid email address"),phone:T.Z_().min(1,"Phone is required"),position:T.Z_().min(1,"Position is required"),department:T.Z_().min(1,"Department is required"),hireDate:T.Z_().datetime(),salary:T.Rx().positive("Salary must be positive"),isActive:T.O7().default(!0)});async function _(e){try{if(!await (0,E.getServerSession)(l.L))return o.Z.json({error:"Authentication required"},{status:401});let{searchParams:t}=new URL(e.url),r=t.get("department"),a=t.get("isActive"),s={};r&&"all"!==r&&(s.department=r),null!==a&&(s.isActive="true"===a);let i=await u.Z.staff.findMany({where:s,orderBy:{name:"asc"}});return o.Z.json(i)}catch(e){return console.error("Error fetching staff:",e),o.Z.json({error:"Failed to fetch staff"},{status:500})}}async function c(e){try{let t=await (0,E.getServerSession)(l.L);if(!t||!["SUPER_ADMIN","MANAGER"].includes(t.user.role))return o.Z.json({error:"Unauthorized"},{status:401});let r=await e.json(),a=p.parse(r);if(await u.Z.staff.findUnique({where:{employeeId:a.employeeId}}))return o.Z.json({error:"Employee ID already exists"},{status:400});if(await u.Z.staff.findUnique({where:{email:a.email}}))return o.Z.json({error:"Email already exists"},{status:400});let s=await u.Z.staff.create({data:{employeeId:a.employeeId,name:a.name,email:a.email,phone:a.phone,position:a.position,department:a.department,hireDate:new Date(a.hireDate),salary:a.salary,isActive:a.isActive}});return await (0,A.ar)(e,t.user.id,A.sZ.STAFF_CREATE,"Staff",s.id,{employeeId:a.employeeId,name:a.name,position:a.position,department:a.department}),o.Z.json(s,{status:201})}catch(e){if(e instanceof d.jm)return o.Z.json({error:"Validation error",details:e.errors},{status:400});return console.error("Error creating staff:",e),o.Z.json({error:"Failed to create staff"},{status:500})}}let m=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/staff/route",pathname:"/api/staff",filename:"route",bundlePath:"app/api/staff/route"},resolvedPagePath:"C:\\Users\\asith\\Documents\\SmartHotel\\app\\api\\staff\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:S,staticGenerationAsyncStorage:O,serverHooks:N,headerHooks:f,staticGenerationBailout:R}=m,I="/api/staff/route";function U(){return(0,n.patchFetch)({serverHooks:N,staticGenerationAsyncStorage:O})}},89391:(e,t,r)=>{r.d(t,{ar:()=>n,sZ:()=>i});var a=r(44843);async function s(e){try{await a.Z.auditLog.create({data:{userId:e.userId||"",action:e.action,entityType:e.resource,entityId:e.resourceId||"",details:e.details||void 0,ipAddress:e.ipAddress||void 0,userAgent:e.userAgent||void 0}})}catch(e){console.error("Failed to create audit log:",e)}}let i={USER_LOGIN:"USER_LOGIN",USER_LOGOUT:"USER_LOGOUT",USER_REGISTER:"USER_REGISTER",USER_UPDATE:"USER_UPDATE",USER_DELETE:"USER_DELETE",STAFF_CREATE:"STAFF_CREATE",STAFF_UPDATE:"STAFF_UPDATE",STAFF_DELETE:"STAFF_DELETE",ROOM_CREATE:"ROOM_CREATE",ROOM_UPDATE:"ROOM_UPDATE",ROOM_DELETE:"ROOM_DELETE",ROOM_STATUS_CHANGE:"ROOM_STATUS_CHANGE",BOOKING_CREATE:"BOOKING_CREATE",BOOKING_UPDATE:"BOOKING_UPDATE",BOOKING_CANCEL:"BOOKING_CANCEL",BOOKING_STATUS_CHANGE:"BOOKING_STATUS_CHANGE",BOOKING_CHECK_IN:"BOOKING_CHECK_IN",BOOKING_CHECK_OUT:"BOOKING_CHECK_OUT",PAYMENT_CREATE:"PAYMENT_CREATE",PAYMENT_SUCCESS:"PAYMENT_SUCCESS",PAYMENT_FAILED:"PAYMENT_FAILED",PAYMENT_REFUND:"PAYMENT_REFUND",TASK_CREATE:"TASK_CREATE",TASK_ASSIGN:"TASK_ASSIGN",TASK_UPDATE:"TASK_UPDATE",TASK_COMPLETE:"TASK_COMPLETE",TASK_DELETE:"TASK_DELETE",INVENTORY_CREATE:"INVENTORY_CREATE",INVENTORY_UPDATE:"INVENTORY_UPDATE",INVENTORY_DELETE:"INVENTORY_DELETE",INVENTORY_ADJUST:"INVENTORY_ADJUST",SETTING_UPDATE:"SETTING_UPDATE",BACKUP_CREATE:"BACKUP_CREATE",SYSTEM_MAINTENANCE:"SYSTEM_MAINTENANCE"};async function n(e,t,r,a,i,n){let{ipAddress:o,userAgent:E}=function(e){let t=e.headers.get("x-forwarded-for");return{ipAddress:t?t.split(",")[0]:e.ip||"unknown",userAgent:e.headers.get("user-agent")||"unknown"}}(e);await s({userId:t,action:r,resource:a,resourceId:i,details:n,ipAddress:o,userAgent:E})}},3205:(e,t,r)=>{r.d(t,{L:()=>E});var a=r(54896),s=r(86485),i=r(6521),n=r.n(i),o=r(44843);let E={adapter:(0,a.N)(o.Z),providers:[(0,s.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await o.Z.user.findUnique({where:{email:e.email}});return t&&await n().compare(e.password,t.password)?{id:t.id,email:t.email,name:t.name,role:t.role}:null}})],session:{strategy:"jwt",maxAge:86400,updateAge:3600},jwt:{maxAge:86400},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.role=t.role),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.role=t.role),e)},pages:{signIn:"/auth/signin"},secret:process.env.NEXTAUTH_SECRET,cookies:{sessionToken:{name:"next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0,maxAge:86400}},callbackUrl:{name:"next-auth.callback-url",options:{sameSite:"lax",path:"/",secure:!0}},csrfToken:{name:"next-auth.csrf-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}}}},44843:(e,t,r)=>{r.d(t,{Z:()=>s});let a=require("@prisma/client"),s=globalThis.prisma??new a.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[1638,9990,5640,8070,7382,5252],()=>r(15173));module.exports=a})();