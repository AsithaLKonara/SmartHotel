"use strict";(()=>{var e={};e.id=1974,e.ids=[1974],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},43281:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>D,originalPathname:()=>C,patchFetch:()=>w,requestAsyncStorage:()=>m,routeModule:()=>O,serverHooks:()=>U,staticGenerationAsyncStorage:()=>R,staticGenerationBailout:()=>I});var s={};r.r(s),r.d(s,{DELETE:()=>N,GET:()=>p,PATCH:()=>S,PUT:()=>_});var a=r(95419),i=r(69108),n=r(99678),o=r(78070),E=r(81355),d=r(3205),u=r(44843),l=r(25252),T=r(52178),A=r(89391);let c=l.Ry({title:l.Z_().min(1,"Title is required").optional(),description:l.Z_().optional(),type:l.Km(["HOUSEKEEPING","MAINTENANCE","ROOM_SERVICE","GUEST_REQUEST","ADMINISTRATIVE"]).optional(),priority:l.Km(["LOW","MEDIUM","HIGH","URGENT"]).optional(),status:l.Km(["PENDING","IN_PROGRESS","COMPLETED","CANCELLED"]).optional(),assignedTo:l.Z_().optional(),dueDate:l.Z_().optional(),completedAt:l.Z_().optional()});async function p(e,{params:t}){try{if(!await (0,E.getServerSession)(d.L))return o.Z.json({error:"Authentication required"},{status:401});let e=await u.Z.task.findUnique({where:{id:t.id},include:{staff:{select:{id:!0,name:!0,email:!0,position:!0,department:!0}},user:{select:{id:!0,name:!0,email:!0}}}});if(!e)return o.Z.json({error:"Task not found"},{status:404});return o.Z.json(e)}catch(e){return console.error("Error fetching task:",e),o.Z.json({error:"Failed to fetch task"},{status:500})}}async function _(e,{params:t}){try{let r=await (0,E.getServerSession)(d.L);if(!r||!["SUPER_ADMIN","MANAGER"].includes(r.user.role))return o.Z.json({error:"Unauthorized"},{status:401});let s=await e.json(),a=c.parse(s),i=await u.Z.task.findUnique({where:{id:t.id}});if(!i)return o.Z.json({error:"Task not found"},{status:404});let n=await u.Z.task.update({where:{id:t.id},data:{...a,assignedTo:a.assignedTo||null,dueDate:a.dueDate?new Date(a.dueDate):void 0,completedAt:a.completedAt?new Date(a.completedAt):void 0},include:{staff:{select:{id:!0,name:!0,email:!0}},user:{select:{id:!0,name:!0,email:!0}}}});return await (0,A.ar)(e,r.user.id,A.sZ.TASK_UPDATE,"Task",t.id,{oldStatus:i.status,newStatus:a.status,oldAssignedTo:i.assignedTo,newAssignedTo:a.assignedTo}),o.Z.json(n)}catch(e){if(e instanceof T.jm)return o.Z.json({error:"Validation error",details:e.errors},{status:400});return console.error("Error updating task:",e),o.Z.json({error:"Failed to update task"},{status:500})}}async function S(e,{params:t}){try{let r=await (0,E.getServerSession)(d.L);if(!r||!["SUPER_ADMIN","MANAGER","RECEPTIONIST"].includes(r.user.role))return o.Z.json({error:"Unauthorized"},{status:401});let s=await e.json(),a=c.parse(s),i=await u.Z.task.findUnique({where:{id:t.id}});if(!i)return o.Z.json({error:"Task not found"},{status:404});let n=await u.Z.task.update({where:{id:t.id},data:{...a,assignedTo:a.assignedTo||null,dueDate:a.dueDate?new Date(a.dueDate):void 0,completedAt:a.completedAt?new Date(a.completedAt):void 0},include:{staff:{select:{id:!0,name:!0,email:!0}},user:{select:{id:!0,name:!0,email:!0}}}});return await (0,A.ar)(e,r.user.id,A.sZ.TASK_UPDATE,"Task",t.id,{oldStatus:i.status,newStatus:a.status,oldAssignedTo:i.assignedTo,newAssignedTo:a.assignedTo}),o.Z.json(n)}catch(e){if(e instanceof T.jm)return o.Z.json({error:"Validation error",details:e.errors},{status:400});return console.error("Error updating task:",e),o.Z.json({error:"Failed to update task"},{status:500})}}async function N(e,{params:t}){try{let r=await (0,E.getServerSession)(d.L);if(!r||"SUPER_ADMIN"!==r.user.role)return o.Z.json({error:"Unauthorized"},{status:401});let s=await u.Z.task.findUnique({where:{id:t.id}});if(!s)return o.Z.json({error:"Task not found"},{status:404});return await u.Z.task.delete({where:{id:t.id}}),await (0,A.ar)(e,r.user.id,A.sZ.TASK_DELETE,"Task",s.id,{title:s.title,type:s.type}),o.Z.json({message:"Task deleted successfully"})}catch(e){return console.error("Error deleting task:",e),o.Z.json({error:"Failed to delete task"},{status:500})}}let O=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/tasks/[id]/route",pathname:"/api/tasks/[id]",filename:"route",bundlePath:"app/api/tasks/[id]/route"},resolvedPagePath:"C:\\Users\\asith\\Documents\\SmartHotel\\app\\api\\tasks\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:R,serverHooks:U,headerHooks:D,staticGenerationBailout:I}=O,C="/api/tasks/[id]/route";function w(){return(0,n.patchFetch)({serverHooks:U,staticGenerationAsyncStorage:R})}},89391:(e,t,r)=>{r.d(t,{ar:()=>n,sZ:()=>i});var s=r(44843);async function a(e){try{await s.Z.auditLog.create({data:{userId:e.userId||"",action:e.action,entityType:e.resource,entityId:e.resourceId||"",details:e.details||void 0,ipAddress:e.ipAddress||void 0,userAgent:e.userAgent||void 0}})}catch(e){console.error("Failed to create audit log:",e)}}let i={USER_LOGIN:"USER_LOGIN",USER_LOGOUT:"USER_LOGOUT",USER_REGISTER:"USER_REGISTER",USER_UPDATE:"USER_UPDATE",USER_DELETE:"USER_DELETE",STAFF_CREATE:"STAFF_CREATE",STAFF_UPDATE:"STAFF_UPDATE",STAFF_DELETE:"STAFF_DELETE",ROOM_CREATE:"ROOM_CREATE",ROOM_UPDATE:"ROOM_UPDATE",ROOM_DELETE:"ROOM_DELETE",ROOM_STATUS_CHANGE:"ROOM_STATUS_CHANGE",BOOKING_CREATE:"BOOKING_CREATE",BOOKING_UPDATE:"BOOKING_UPDATE",BOOKING_CANCEL:"BOOKING_CANCEL",BOOKING_STATUS_CHANGE:"BOOKING_STATUS_CHANGE",BOOKING_CHECK_IN:"BOOKING_CHECK_IN",BOOKING_CHECK_OUT:"BOOKING_CHECK_OUT",PAYMENT_CREATE:"PAYMENT_CREATE",PAYMENT_SUCCESS:"PAYMENT_SUCCESS",PAYMENT_FAILED:"PAYMENT_FAILED",PAYMENT_REFUND:"PAYMENT_REFUND",TASK_CREATE:"TASK_CREATE",TASK_ASSIGN:"TASK_ASSIGN",TASK_UPDATE:"TASK_UPDATE",TASK_COMPLETE:"TASK_COMPLETE",TASK_DELETE:"TASK_DELETE",INVENTORY_CREATE:"INVENTORY_CREATE",INVENTORY_UPDATE:"INVENTORY_UPDATE",INVENTORY_DELETE:"INVENTORY_DELETE",INVENTORY_ADJUST:"INVENTORY_ADJUST",SETTING_UPDATE:"SETTING_UPDATE",BACKUP_CREATE:"BACKUP_CREATE",SYSTEM_MAINTENANCE:"SYSTEM_MAINTENANCE"};async function n(e,t,r,s,i,n){let{ipAddress:o,userAgent:E}=function(e){let t=e.headers.get("x-forwarded-for");return{ipAddress:t?t.split(",")[0]:e.ip||"unknown",userAgent:e.headers.get("user-agent")||"unknown"}}(e);await a({userId:t,action:r,resource:s,resourceId:i,details:n,ipAddress:o,userAgent:E})}},3205:(e,t,r)=>{r.d(t,{L:()=>E});var s=r(54896),a=r(86485),i=r(6521),n=r.n(i),o=r(44843);let E={adapter:(0,s.N)(o.Z),providers:[(0,a.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await o.Z.user.findUnique({where:{email:e.email}});return t&&await n().compare(e.password,t.password)?{id:t.id,email:t.email,name:t.name,role:t.role}:null}})],session:{strategy:"jwt",maxAge:86400,updateAge:3600},jwt:{maxAge:86400},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.role=t.role),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.role=t.role),e)},pages:{signIn:"/auth/signin"},secret:process.env.NEXTAUTH_SECRET,cookies:{sessionToken:{name:"next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0,maxAge:86400}},callbackUrl:{name:"next-auth.callback-url",options:{sameSite:"lax",path:"/",secure:!0}},csrfToken:{name:"next-auth.csrf-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}}}},44843:(e,t,r)=>{r.d(t,{Z:()=>a});let s=require("@prisma/client"),a=globalThis.prisma??new s.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[1638,9990,5640,8070,7382,5252],()=>r(43281));module.exports=s})();