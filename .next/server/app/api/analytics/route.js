"use strict";(()=>{var e={};e.id=1567,e.ids=[1567],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},78899:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>E,originalPathname:()=>q,patchFetch:()=>N,requestAsyncStorage:()=>b,routeModule:()=>M,serverHooks:()=>A,staticGenerationAsyncStorage:()=>D,staticGenerationBailout:()=>S});var n={};r.r(n),r.d(n,{GET:()=>x});var a=r(95419),o=r(69108),i=r(99678),s=r(78070),l=r(81355),u=r(3205),c=r(44843),d=r(18728),p=r(33921),g=r(12110),h=r(20217);function v(e,t){(0,g.Z)(1,arguments);var r,n,a,o,i,s,l,u,c=(0,h.j)(),v=(0,p.Z)(null!==(r=null!==(n=null!==(a=null!==(o=null==t?void 0:t.weekStartsOn)&&void 0!==o?o:null==t?void 0:null===(i=t.locale)||void 0===i?void 0:null===(s=i.options)||void 0===s?void 0:s.weekStartsOn)&&void 0!==a?a:c.weekStartsOn)&&void 0!==n?n:null===(l=c.locale)||void 0===l?void 0:null===(u=l.options)||void 0===u?void 0:u.weekStartsOn)&&void 0!==r?r:0);if(!(v>=0&&v<=6))throw RangeError("weekStartsOn must be between 0 and 6 inclusively");var m=(0,d.Z)(e),f=m.getDay();return m.setDate(m.getDate()-((f<v?7:0)+f-v)),m.setHours(0,0,0,0),m}function m(e,t){(0,g.Z)(1,arguments);var r,n,a,o,i,s,l,u,c=(0,h.j)(),v=(0,p.Z)(null!==(r=null!==(n=null!==(a=null!==(o=null==t?void 0:t.weekStartsOn)&&void 0!==o?o:null==t?void 0:null===(i=t.locale)||void 0===i?void 0:null===(s=i.options)||void 0===s?void 0:s.weekStartsOn)&&void 0!==a?a:c.weekStartsOn)&&void 0!==n?n:null===(l=c.locale)||void 0===l?void 0:null===(u=l.options)||void 0===u?void 0:u.weekStartsOn)&&void 0!==r?r:0);if(!(v>=0&&v<=6))throw RangeError("weekStartsOn must be between 0 and 6 inclusively");var m=(0,d.Z)(e),f=m.getDay();return m.setDate(m.getDate()+((f<v?-7:0)+6-(f-v))),m.setHours(23,59,59,999),m}function f(e){(0,g.Z)(1,arguments);var t=(0,d.Z)(e);return t.setDate(1),t.setHours(0,0,0,0),t}function w(e){(0,g.Z)(1,arguments);var t=(0,d.Z)(e),r=t.getMonth();return t.setFullYear(t.getFullYear(),r+1,0),t.setHours(23,59,59,999),t}function y(e){(0,g.Z)(1,arguments);var t=(0,d.Z)(e);return t.setHours(0,0,0,0),t}function Z(e){(0,g.Z)(1,arguments);var t=(0,d.Z)(e);return t.setHours(23,59,59,999),t}var k=r(76788);async function x(e){try{let t,r;let n=await (0,l.getServerSession)(u.L);if(!n||!["SUPER_ADMIN","MANAGER"].includes(n.user.role))return s.Z.json({error:"Unauthorized"},{status:401});let{searchParams:a}=new URL(e.url),o=a.get("range")||"month",i=new Date;switch(o){case"week":t=v(i),r=m(i);break;case"month":default:t=f(i),r=w(i);break;case"year":t=new Date(i.getFullYear(),0,1),r=new Date(i.getFullYear(),11,31)}let[h,x,M]=await Promise.all([c.Z.booking.findMany({include:{room:!0,user:!0,invoice:!0},orderBy:{createdAt:"desc"}}),c.Z.room.findMany(),c.Z.invoice.findMany({include:{booking:!0}})]),b=M.reduce((e,t)=>e+t.total,0),D=M.filter(e=>{let t=new Date(e.createdAt);return t>=f(i)&&t<=w(i)}).reduce((e,t)=>e+t.total,0),A=M.filter(e=>{let t=new Date(e.createdAt);return t>=v(i)&&t<=m(i)}).reduce((e,t)=>e+t.total,0),E=M.filter(e=>{let t=new Date(e.createdAt);return t>=y(i)&&t<=Z(i)}).reduce((e,t)=>e+t.total,0),S=x.length,q=x.filter(e=>"OCCUPIED"===e.status).length,N=S>0?Math.round(q/S*100):0,O=h.length,T=h.filter(e=>"CONFIRMED"===e.status).length,R=h.filter(e=>"PENDING"===e.status).length,j=h.filter(e=>"CANCELLED"===e.status).length,H=x.filter(e=>"AVAILABLE"===e.status).length,I=x.filter(e=>"MAINTENANCE"===e.status).length,P=x.map(e=>{let t=h.filter(t=>t.roomId===e.id),r=t.reduce((e,t)=>{let r=M.find(e=>e.bookingId===t.id);return e+(r?.total||0)},0),n=S>0?Math.round(t.length/O*100):0;return{roomNumber:e.number,type:e.type,bookings:t.length,revenue:r,occupancyRate:n}}).sort((e,t)=>t.revenue-e.revenue).slice(0,10),C=(function(e,t){(0,g.Z)(1,arguments);var r,n=e||{},a=(0,d.Z)(n.start),o=(0,d.Z)(n.end).getTime();if(!(a.getTime()<=o))throw RangeError("Invalid interval");var i=[];a.setHours(0,0,0,0);var s=Number(null!==(r=null==t?void 0:t.step)&&void 0!==r?r:1);if(s<1||isNaN(s))throw RangeError("`options.step` must be a number greater than 1");for(;a.getTime()<=o;)i.push((0,d.Z)(a)),a.setDate(a.getDate()+s),a.setHours(0,0,0,0);return i})({start:t,end:r}).map(e=>{let t=h.filter(t=>{let r=new Date(t.createdAt);return r>=y(e)&&r<=Z(e)}),r=t.reduce((e,t)=>{let r=M.find(e=>e.bookingId===t.id);return e+(r?.total||0)},0);return{date:(0,k.Z)(e,"yyyy-MM-dd"),revenue:r,bookings:t.length}}),F=(function(e){(0,g.Z)(1,arguments);var t=e||{},r=(0,d.Z)(t.start),n=(0,d.Z)(t.end).getTime(),a=[];if(!(r.getTime()<=n))throw RangeError("Invalid interval");for(r.setHours(0,0,0,0),r.setDate(1);r.getTime()<=n;)a.push((0,d.Z)(r)),r.setMonth(r.getMonth()+1);return a})({start:function(e,t){return(0,g.Z)(2,arguments),function(e,t){(0,g.Z)(2,arguments);var r=(0,d.Z)(e),n=(0,p.Z)(t);if(isNaN(n))return new Date(NaN);if(!n)return r;var a=r.getDate(),o=new Date(r.getTime());return(o.setMonth(r.getMonth()+n+1,0),a>=o.getDate())?o:(r.setFullYear(o.getFullYear(),o.getMonth(),a),r)}(e,-(0,p.Z)(11))}(i,11),end:i}).map(e=>{let t=h.filter(t=>{let r=new Date(t.createdAt);return r>=f(e)&&r<=w(e)}),r=t.reduce((e,t)=>{let r=M.find(e=>e.bookingId===t.id);return e+(r?.total||0)},0),n=t.length>0?Math.round(t.length/(30*S)*100):0;return{month:(0,k.Z)(e,"MMM yyyy"),revenue:r,bookings:t.length,occupancy:n}}),U=Math.max(0,N-Math.floor(20*Math.random()));return s.Z.json({revenue:{today:E,thisWeek:A,thisMonth:D,total:b},occupancy:{current:N,average:Math.round((N+U)/2),trend:N-U},bookings:{total:O,confirmed:T,pending:R,cancelled:j},rooms:{total:S,available:H,occupied:q,maintenance:I},topRooms:P,guestSources:[{source:"Direct Website",count:Math.floor(.4*O),percentage:40},{source:"Online Travel Agencies",count:Math.floor(.3*O),percentage:30},{source:"Phone Reservations",count:Math.floor(.15*O),percentage:15},{source:"Walk-in",count:Math.floor(.1*O),percentage:10},{source:"Corporate",count:Math.floor(.05*O),percentage:5}],dailyRevenue:C,monthlyTrends:F})}catch(e){return console.error("Error fetching analytics:",e),s.Z.json({error:"Failed to fetch analytics data"},{status:500})}}let M=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/analytics/route",pathname:"/api/analytics",filename:"route",bundlePath:"app/api/analytics/route"},resolvedPagePath:"C:\\Users\\asith\\Documents\\SmartHotel\\app\\api\\analytics\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:b,staticGenerationAsyncStorage:D,serverHooks:A,headerHooks:E,staticGenerationBailout:S}=M,q="/api/analytics/route";function N(){return(0,i.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:D})}},3205:(e,t,r)=>{r.d(t,{L:()=>l});var n=r(54896),a=r(86485),o=r(6521),i=r.n(o),s=r(44843);let l={adapter:(0,n.N)(s.Z),providers:[(0,a.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;let t=await s.Z.user.findUnique({where:{email:e.email}});return t&&await i().compare(e.password,t.password)?{id:t.id,email:t.email,name:t.name,role:t.role}:null}})],session:{strategy:"jwt",maxAge:86400,updateAge:3600},jwt:{maxAge:86400},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.role=t.role),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.role=t.role),e)},pages:{signIn:"/auth/signin"},secret:process.env.NEXTAUTH_SECRET,cookies:{sessionToken:{name:"next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0,maxAge:86400}},callbackUrl:{name:"next-auth.callback-url",options:{sameSite:"lax",path:"/",secure:!0}},csrfToken:{name:"next-auth.csrf-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0}}}}},44843:(e,t,r)=>{r.d(t,{Z:()=>a});let n=require("@prisma/client"),a=globalThis.prisma??new n.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[1638,9990,5640,8070,7382,6788],()=>r(78899));module.exports=n})();